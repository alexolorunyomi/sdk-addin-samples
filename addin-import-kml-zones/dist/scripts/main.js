"use strict";var angularObj={app:null,initAngular:function(){var r=document.getElementById("importKmlZones");angularObj.app=angular.module("importKMLZones",[]),angularObj.app.directive("modalDialog",function(){return{restrict:"E",scope:{show:"="},replace:!0,transclude:!0,link:function(e,t,n){e.dialogStyle={},n.width&&(e.dialogStyle.width=n.width),n.height&&(e.dialogStyle.height=n.height),e.hideModal=function(){e.show=!1,r.style.overflow="",r.style.height="auto"}},template:"<div class='ng-modal' ng-show='show'><div class='ng-modal-overlay' ng-click='hideModal()'></div><div class='ng-modal-dialog' ng-style='dialogStyle'><div class='ng-modal-close' ng-click='hideModal()'>X</div><div class='ng-modal-dialog-content' ng-transclude></div></div></div>"}}),angularObj.app.service("clearService",function(){var e={clear:function(){kml.clear()}};return e}),angularObj.app.controller("optionsController",["$scope","clearService",function(n,e){n.modalShown=!1,n.toggleModal=function(){var t=function(e){n.zoneTypeOptions=[],kml.prevSelectedTypes=[],e.forEach(function(e){n.zoneTypeOptions.push({id:e.id,name:e.name,isSystem:!!e.isSystem&&e.isSystem,comment:e.comment?e.comment:""})}),n.$apply(),kml.options.zoneTypes.every(function(e,t){var n=r.querySelector("#typesSelect");return e!==kml.defaultZoneType||-1!==n.selectedIndex||(n.selectedIndex=t,!1)})};kml.api.call("Get",{typeName:"ZoneType"},function(e){t(kml.addSystemZoneTypes(e,!0))},function(){t(kml.addSystemZoneTypes([],!0))}),n.colorPickerValue=kml.colorPicker.getPicker().getHexValue(),n.transparencySliderValue=n.transparencySliderValue||kml.colorPicker.getDefaultTransparencyValue(),kml.utils.inputTypeSupport("range","a")&&(r.querySelector(".vanillaSlider").value=n.transparencySliderValue),angular.element(r.querySelector("input.vanillaSlider")).on("input",function(e){var t=e.target.value;n.transparencySliderValue=Number(t),kml.colorPicker.getTransparencyControl().set({a:t}),r.querySelector("#colorPickerField").style.opacity=(100-t)/100,n.$apply()});var e=r.querySelector("#colorPickerField");kml.utils.inputTypeSupport("color","hello world")?angular.element(e).on("change",function(){kml.colorPicker.getPicker().setValue(kml.utils.hexToRGBArray(this.value))}):(angular.element(e).on("focus",function(){kml.colorPicker.getPicker().originalPicker.showPicker(this)}),angular.element(e).on("blur",function(){var e=kml.colorPicker.getPicker().originalPicker.valueElement.value;!1===kml.colorPicker.getPicker().originalPicker.pickerIsActive?kml.colorPicker.getPicker().originalPicker.hidePicker():(n.colorPickerValue=e,this.value=e,this.style.backgroundColor=e,n.$apply(),this.focus())})),n.modalShown=!n.modalShown,!0===n.modalShown&&(r.style.overflow="hidden",r.style.height="100%")},n.setQuickColor=function(e){n.colorPickerValue=kml.colorPicker.setQuickColor(e)},n.changeZoneStop=function(e){e.target.checked||e.preventDefault();for(var t=e.target.parentNode.querySelectorAll(".geotabSwitchButton"),n=0;n<t.length;n++)t[n].id!==e.target.id&&(t[n].checked=!1);e.target.checked=!0},n.applyOptions=function(){kml.applyOptions(),r.style.overflow="",r.style.height="auto",n.modalShown=!1},n.setDefaultOptions=function(){kml.setDefaultOptions(),n.colorPickerValue=kml.colorPicker.getDefaultColorHex(),n.transparencySliderValue=kml.colorPicker.getDefaultTransparencyValue(),kml.utils.inputTypeSupport("range","a")&&(r.querySelector(".vanillaSlider").value=n.transparencySliderValue)},n.clear=function(){e.clear()},n.selectType=function(e){var t,n=null,o=r.querySelector("#typesSelect");for(kml.prevSelectedTypes=kml.prevSelectedTypes||[],setTimeout(function(){for(t=0;t<kml.prevSelectedTypes.length;t++)o.options[kml.prevSelectedTypes[t]].selected=!0;null!==n&&(o.options[n].selected=!1)},0),kml.selectedTypes=o.selectedOptions||kml.utils.getSelectValues(o),t=0;t<kml.selectedTypes.length;t++)-1===kml.prevSelectedTypes.indexOf(kml.selectedTypes[t].index)&&kml.prevSelectedTypes.push(kml.selectedTypes[t].index);e.target.selected?(n=e.target.index,kml.prevSelectedTypes.splice(kml.prevSelectedTypes.indexOf(n),1)):n=null}}]),angularObj.app.controller("parsedDataController",["$scope","clearService",function(e,n){e.uploaderTitle=kml.isFormDataSupported?"Drop your files here or click to select them":"Click here to choose kml file",e.importSelectedZones=function(){kml.importZones()},e.hideImported=function(e){kml.hideImported(e)},e.exportKML=function(){kml.exportKML()},e.selectAll=function(e){kml.selectAll(e)},e.uploadFiles=function(e){var t=e.target.files;n.clear(),kml.parseFiles(t)}}])}};function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}!function(){var e={api:null,state:null,args:{},item:null,childCallback:{},minDate:new Date(Date.UTC(1986,0,1)),defaultZoneSize:200,localInit:["addressLookup","Address Lookup","customer","Customer","office","Office","home","Home"],isFormDataSupported:!!window.FormData,fileReader:null,filter:null,colorPickerObj:null,zoneCreator:null,options:{},zonesData:{zones:[],commonStyles:[]},uploader:null,utils:null,colorPicker:null,vanillaSlider:null,waiting:null,importedInBG:[],itemsPerCall:50,defaultZoneType:"ZoneTypeCustomerId",initVariables:function(e,t){var n=this;this.api=e,this.state=t,this.args.container=document.getElementById("importKmlZones"),this.local=this.setupLocal(this.localInit),this.filter=t.getGroupFilter(),this.utils=new Utils,this.fileReader="undefined"!=typeof FileReader?new FileReader:null,this.uploader=new Uploader,this.vanillaSlider=new VanillaSlider,this.waiting=new Waiting,Array.prototype.forEach.call(this.args.container.parentNode.getElementsByClassName("extern"),function(e){e.id&&(n.args[e.id]=e)}),this.colorPicker=new ColorPicker,this.colorPickerObj=this.colorPicker.formColorPicker(),this.zoneCreator=this.zoneShapeCreator(),this.options={zoneTypes:[this.defaultZoneType],zoneSize:this.defaultZoneSize,zoneColor:this.colorPickerObj.value(),zoneShape:!1,stoppedInsideZones:this.args.container.querySelector("#stoppedInsideZones").checked}},NOOP:function(){},setupLocal:function(e){var t,n,o={};if(e.length%2!=0)throw new Error("incorrect data items");for(t=0;t<e.length;t+=2){if(o[n=e[t]])throw new Error(n+" already added");o[n]=e[t+1]}return o},addSystemZoneTypes:function(e,t){var n,o,r,l,i={ZoneTypeAddressLookupId:this.local.addressLookup,ZoneTypeCustomerId:this.local.customer,ZoneTypeOfficeId:this.local.office,ZoneTypeHomeId:this.local.home},a=!1;for(n=0,o=e.length;n<o;n+=1)r=(l=e[n]).id||l,l.id||(t&&"ZoneTypeAddressLookupId"===r?(e.splice(n,1),n-=1,o-=1):(a=!0,e[n]={id:l,name:i[r],isSystem:!0}));if(!a)for(var s in i)!i.hasOwnProperty(s)||t&&"ZoneTypeAddressLookupId"===s||e.push({id:s,name:i[s],comment:this.localInit.systemAssignedComment,isSystem:!0});return e},zoneShapeCreator:function(){return{getZonePoints:function(e,t,n,o){var r=n?360*n/40075e3:.0018;return o?function(e,t,n){var o,r,l,i=n/2,a=i-8e-5/n*n,s=2*Math.sqrt(i*i-a*a),c=Math.ceil(Math.PI/Math.asin(s/(2*i))),u=c<20?20:c+1,d=2*Math.PI/(u-1),p=0,m=[];for(l=0;l<u;l++)r=e+i*Math.cos(p),o=t+i*Math.sin(p)/Math.abs(Math.cos(r*Math.PI/180)),m.push({x:o,y:r}),p+=d;return m}(e,t,r):function(e,t,n){var o,r=n/2||9e-4,l=[[1,1],[-1,1],[-1,-1],[1,-1]],i=[];for(o=0;o<l.length;o++)i.push({x:t+l[o][0]*r,y:e+l[o][1]*r/1.5});return i}(e,t,r)}}},parseFiles:function(i){var a=this,s=i.length,c=0;0!==s&&(this.waiting.show(),this.fileReader.onload=function(e){var t,n,o,r=e.target.result,l=(new DOMParser).parseFromString(r,"text/xml");if(a.isFileDataValid(l,i[c].name)){for(t=l.documentElement.querySelectorAll("Placemark"),n=l.documentElement.querySelectorAll("Style"),o=0;o<t.length;o++)a.zonesData.zones.push(t[o]);for(o=0;o<n.length;o++)n[o].id&&(a.zonesData.commonStyles[n[o].id]=n[o])}++c<s?a.fileReader.readAsText(i[c]):c===s&&a.populateZoneTables(),a.waiting.hide()},this.fileReader.readAsText(i[0]))},isFileDataValid:function(e,t){var n=e.documentElement.querySelector("Placemark");return"kml"===e.documentElement.tagName.toLowerCase()&&n?0===n.getElementsByTagName("name").length?(this.utils.showError("Name field required in "+t+"."),!1):!(!this.isPoint(n)&&!this.isPolygon(n))||(this.utils.showError(t+" must content a point or polygon data."),!1):(this.utils.showError("File '"+t+"' content format is incorrect."),!1)},populateZoneTables:function(){var s=this,c=!1;this.zonesData.zones.forEach(function(e,t){e.zoneParameters=s.getZoneParameters(e);var n,o,r,l,i=e.zoneParameters.isPolygon?s.args.container.querySelector("#polygonList table"):s.args.container.querySelector("#pointList table"),a=function(e){var t,n={valid:!0,message:""},o=function(e,t,n){return!!(!isNaN(e)&&t<=e&&e<=n)};for(0===e.name.length&&(n.valid=!1,n.message+="Zone name can not be empty. "),0===e.points.length&&(n.valid=!1,n.message+="Zone coordinates can not be empty. "),t=0;t<e.points.length;t++)o(e.points[t].y,-90,90)||(n.valid=!1,n.message+="Latitude coordinate value = "+e.points[t].y+" is incorrect. "),o(e.points[t].x,-180,180)||(n.valid=!1,n.message+="Longitude coordinate value = "+e.points[t].x+" is incorrect. ");return n}(e.zoneParameters);"none"===i.parentNode.style.display&&(i.parentNode.style.display=""),(n=document.createElement("tr")).id="row"+t,o=document.createElement("td"),i.querySelector("tbody").appendChild(n),n.appendChild(o),o.textContent=e.zoneParameters.name,(o=o.cloneNode()).textContent=e.zoneParameters.comment||"-",n.appendChild(o),o=o.cloneNode(),e.zoneParameters.colorFromOptions?o.textContent="Set by options.":((l=document.createElement("div")).className="colorDiv",l.style.backgroundColor=s.utils.rgbToHex.apply(s.utils,s.utils.colorObjToArr(e.zoneParameters.fillColor)),l.style.opacity=e.zoneParameters.fillColor.a/255,o.appendChild(l)),n.appendChild(o),o=o.cloneNode(),!0===a.valid?(c=!0,(r=document.createElement("input")).type="checkbox",r.id=t,r.className="importCheckbox",r.checked=!0,o.appendChild(r)):(n.className="error",s.args.container.querySelector("#exportKML").style.display="",o.textContent=a.message),n.appendChild(o)}),!0===c&&(this.args.container.querySelector("#importButton").style.display="",this.args.container.querySelector("#selectAll").checked=!0,this.args.container.querySelector("#selectAllLabel").style.display="")},isPoint:function(e){var t=e.getElementsByTagName("Point");return 0<t.length&&0<t[0].getElementsByTagName("coordinates").length},isPolygon:function(e){var t=e.getElementsByTagName("Polygon"),n=0<t.length?t[0].getElementsByTagName("outerBoundaryIs"):[],o=0<n.length?n[0].getElementsByTagName("LinearRing"):[];return 0<t.length&&0<n.length&&0<o.length&&0<o[0].getElementsByTagName("coordinates").length},getZoneParameters:function(e){var t,n=e.getElementsByTagName("description"),o=0<e.getElementsByTagName("Style").length?e.getElementsByTagName("Style")[0]:null,r=0<e.getElementsByTagName("styleUrl").length?e.getElementsByTagName("styleUrl")[0].textContent.replace("#",""):null,l=r?this.zonesData.commonStyles[r]:null,i=o||l,a=!0;if(i){var s=i.getElementsByTagName("PolyStyle"),c=s&&0<s.length?s[0].querySelector("color"):null,u=c?c.textContent.replace("#","").trim():null;if(u){var d=u.slice(-2)+u.slice(4,6)+u.slice(2,4),p=u.slice(0,2),m=this.utils.hexToRGBArray(d);a=!(t={r:m[0],g:m[1],b:m[2],a:parseInt(p,16)})}}return{activeFrom:this.minDate,activeTo:new Date(2050,0,1),comment:0<n.length?this.utils.decodeHTMLEntities(n[0].textContent):"",displayed:!0,externalReference:"",fillColor:a?this.options.zoneColor:t,colorFromOptions:a,groups:this.filter,name:this.utils.decodeHTMLEntities(e.getElementsByTagName("name")[0].textContent.trim()),points:this.getPoints(e),zoneTypes:this.options.zoneTypes,zoneSize:this.options.zoneSize,zoneShape:this.options.zoneShape,mustIdentifyStops:this.options.stoppedInsideZones,isPolygon:this.isPolygon(e),isPoint:this.isPoint(e)}},getPoints:function(e){var t="",r=[],l=function(e,t,n,o){var r=function(e){return e*(Math.PI/180)},l=r(n-e),i=r(o-t),a=Math.sin(l/2)*Math.sin(l/2)+Math.cos(r(e))*Math.cos(r(n))*Math.sin(i/2)*Math.sin(i/2);return 6371*(2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a)))};if(this.isPoint(e))t=e.querySelector("coordinates").textContent,r=this.zoneCreator.getZonePoints(1*t.split(",")[1],1*t.split(",")[0],this.options.zoneSize,this.options.zoneShape);else if(this.isPolygon(e)){var n=e.getElementsByTagName("Polygon")[0],o=n.getElementsByTagName("outerBoundaryIs"),i=n.getElementsByTagName("innerBoundaryIs");if(0<o.length&&0<i.length){var a=o[0].querySelector("coordinates"),s=i[0].querySelector("coordinates"),c=a.textContent.trim().split(/\s/),u=s.textContent.trim().split(/\s/),d=null,p=0,m=0,h=function(e,t,n){for(var o=e;o<t;o++)0<n[o].length&&r.push({x:n[o].split(",")[0],y:n[o].split(",")[1]})};c.forEach(function(n,o){0<n.length&&(n=n.split(","),u.forEach(function(e,t){0<e.length&&(e=e.split(","),null===d?d=l(n[0],n[1],e[0],e[1]):d>l(n[0],n[1],e[0],e[1])&&(d=l(n[0],n[1],e[0],e[1]),p=o,m=t))}))}),h(0,p+1,c),h(m,u.length,u),h(1,m+1,u),h(p,c.length,c)}else 0<o.length&&0===i.length&&(t=o[0].querySelector("coordinates")).textContent.trim().split(/\s/).forEach(function(e){0<e.length&&r.push({x:e.split(",")[0],y:e.split(",")[1]})})}return r},markRowSuccess:function(e,t){var n=document.getElementById("row"+e),o=document.createElement("a"),r=document.createElement("button"),l=document.createElement("span");n.className="imported",n.lastChild.textContent="Zone successfully imported.",l.className="geotabButtonIcons iconSearch",r.appendChild(l),r.style.float="right",r.className="geotabButton emptyButton",o.appendChild(r),o.href="#map,zones:!((id:"+t+"))",n.firstChild.appendChild(o)},markRowError:function(e,t){var n=document.getElementById("row"+e);n.className="error",n.lastChild.textContent=t},updateControlsVisibility:function(e){if(!this.args.container)return!1;var t=this.args.container.querySelectorAll(".imported"),n=this.args.container.querySelectorAll(".error");0<t.length&&(this.args.container.querySelector("#hideImportedLabel").style.display=""),0<n.length&&(this.args.container.querySelector("#exportKML").style.display=""),e&&this.args.container.querySelector("#importButton").removeAttribute("disabled"),0===this.args.container.getElementsByClassName("importCheckbox").length&&(this.args.container.querySelector("#selectAllLabel").style.display="none")},saveZones:function(n){var r=this,t=[],o=[],l=0,i=0,a=function(e){if(i++,r.waiting.updateProgressBar(100*e/n.length),i===o.length){r.waiting.hideProgressBar();var t=r.args.container.querySelector("#importButton");t&&t.removeAttribute("disabled")}else s(o[i]);r.updateControlsVisibility()},s=function(e){r.api.multiCall(e,function(o){e.every(function(e,t){var n="string"==typeof o?o:o[t];return r.args.container?r.markRowSuccess(e[1].entity.rowId,n):r.importedInBG.push({rowId:e[1].entity.rowId,id:n}),!0}),a(e.length)},function(t){e.every(function(e){return r.args.container?r.markRowError(e[1].entity.rowId,t):r.importedInBG.push({rowId:e[1].entity.rowId,message:t}),!0}),a(e.length)})};0!==n.length?(n.every(function(e){return l<r.itemsPerCall?l++:(o.push(t),t=[],l=1),t.push(["Add",{typeName:"Zone",entity:e}]),!0}),0<t.length&&o.push(t),this.args.container.querySelector("#importButton").setAttribute("disabled","disabled"),this.waiting.showProgressBar(),s(o[0])):alert("No selected zones to import.")},updateImportedInBG:function(){var t=this;this.importedInBG.every(function(e){return void 0!==e.id?t.markRowSuccess(e.rowId,e.id):void 0!==e.message&&t.markRowError(e.rowId,e.message),!0}),this.updateControlsVisibility(!0),this.importedInBG=[]},importZones:function(){for(var e=this.args.container.getElementsByClassName("importCheckbox"),t=[],n=0;n<e.length;n++)e[n].checked&&(t.push(this.zonesData.zones[e[n].id].zoneParameters),t[t.length-1].rowId=e[n].id);this.saveZones(t)},hideImported:function(e){var t,n=this.args.container.getElementsByClassName("imported");if(!0===e.currentTarget.checked)for(t=0;t<n.length;t++)n[t].style.display="none";else for(t=0;t<n.length;t++)n[t].style.display=""},exportKML:function(){var e,t,o=this,n=this.args.container.querySelectorAll(".checkmateListTable .error"),r="",l="download"in document.createElement("a"),i=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder;for(e=0;e<n.length;e++){var a=this.zonesData.zones[n[e].id.replace("row","")];r+=(new XMLSerializer).serializeToString(a)}r='<?xml version="1.0" encoding="UTF-8"?>\n<kml>'+r+"</kml>",navigator.saveBlob=navigator.saveBlob||navigator.msSaveBlob||navigator.mozSaveBlob||navigator.webkitSaveBlob,window.saveAs=window.saveAs||window.webkitSaveAs||window.mozSaveAs||window.msSaveAs,i&&(window.saveAs||navigator.saveBlob)?t=function(e,t){var n,o=new i;o.append(e),n=o.getBlob("text/plain; charset=UTF-8"),window.saveAs?window.saveAs(n,t):navigator.saveBlob(n,t)}:l&&(t=function(e,t){var n=document.createElement("a");n.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(r)),n.setAttribute("download",t),n.style.display="none",o.args.container.appendChild(n),n.click(),o.args.container.removeChild(n)}),t?t(r,"not_imported.kml"):alert("Your browser does not support any method of saving JavaScript gnerated data to files.")},selectAll:function(e){var t,n=document.getElementsByClassName("importCheckbox");for(t=0;t<n.length;t++)n[t].checked=!!e.currentTarget.checked},clearDataTables:function(){var r=this,e=function(e){var t=r.args.container.querySelector("#"+e+" table"),n=t.querySelectorAll("tr");if(2<n.length)for(var o=2;o<n.length;o++)n[o].parentNode.removeChild(n[o]);"none"!==t.parentNode.style.display&&(t.parentNode.style.display="none",r.args.container.querySelector("#importButton").style.display="none",r.args.container.querySelector("#hideImportedLabel").style.display="none",r.args.container.querySelector("#progressContainer").style.display="none",r.args.container.querySelector("#exportKML").style.display="none")};e("polygonList"),e("pointList"),this.args.container.querySelector("#selectAll").checked=!1,this.args.container.querySelector("#selectAllLabel").style.display="none",this.utils.hideError()},applyOptions:function(){for(var t=this,n=this.args.container.querySelector("#typesSelect").selectedOptions||this.utils.getSelectValues(this.args.container.querySelector("#typesSelect")),o=[],e=this.args.container.querySelector("#optionsControllerElement"),r=angular.element(e).scope().zoneTypeOptions,l=0;l<n.length;l++)r.every(function(e){return e.id!==n[l].value||(o.push(!0===e.isSystem?e.id:e),!1)});this.options.zoneTypes=o,this.options.zoneColor=this.colorPickerObj.value(),this.options.transparencyValue=this.colorPicker.getTransparencyControl().get(),this.options.stoppedInsideZones=this.args.container.querySelector("#stoppedInsideZones").checked,this.zonesData.zones.forEach(function(e){e.zoneParameters=t.getZoneParameters(e)})},setDefaultOptions:function(){for(var e=this.args.container.querySelector("#typesSelect"),t=this.args.container.querySelector("#colorPickerField"),n=0;n<e.options.length;n++)e.options[n].selected=e.options[n].value===this.defaultZoneType;this.colorPicker.setDefaultColor(),t.value=this.colorPicker.getDefaultColorHex(),t.style.opacity=this.colorPicker.getDefaultColor()[3]/255,this.args.container.querySelector("#stoppedInsideZonesNo").checked=!1,this.args.container.querySelector("#stoppedInsideZones").checked=!0},clear:function(){this.uploader.clear(),this.zonesData.zones=[],this.zonesData.commonStyles=[],this.clearDataTables()}},t=function(){return this||(0,eval)("this")}();"undefined"!=typeof module&&module.exports?module.exports=e:"function"==typeof define&&define.amd?define(function(){return e}):t.kml=e}(),function(){var e=function(){var o,r,c,u,l,i,d,a={path:!0,circle:!0,svg:!0,rect:!0,text:!0};return{vanilla:(o=function(e){var t="string"==typeof e.className?e:e.className,n="string"==typeof e.className?"className":"baseVal";return{get:function(){return t[n]},set:function(e){t[n]=e}}},r=function(e,t){if(e.classList)e.classList.add(t);else{var n=o(e);n.get().indexOf(t)<0&&n.set(n.get()+(n.get()?" ":"")+t)}},c=function(e){return-1!==Object.prototype.toString.call(e).indexOf("Array")},u=function(e){return-1!==Object.prototype.toString.call(e).indexOf("Object")},l=function(e,t){return e.style.display=t,e},i=function(e){return e.currentStyle?e.currentStyle.display:window.getComputedStyle?window.getComputedStyle(e,null).getPropertyValue("display"):void 0},d={addClasses:function(e,t){var n,o=t.split(" ");for(n=0;n<o.length;n++)r(e,o[n])},hasClass:function(e,t){return-1!==o(e).get().indexOf(t)},css:function(e,t){var n,o;Object.keys(t).forEach((n=e,o=t,function(e){n.style[e]=o[e]}))},create:function(n,e,t){var o,r,l,i=(o=(n||"").toUpperCase(),a.hasOwnProperty(o.toLowerCase())?document.createElementNS("http://www.w3.org/2000/svg",o):document.createElement(o));return e&&Object.keys(e).forEach((r=i,l=e,function(t){try{r.setAttribute(t,l[t])}catch(e){throw new Error("Try to set "+t+" attribute "+l[t]+" to "+r.tagName+" ("+n+"). Connected with this error: "+e.message)}})),t&&d.css(i,t),i},extend:function(){var e,t,n,o,r,l=arguments.length,i=!1,a=arguments[0],s=1;for("boolean"==typeof a&&(i=a,a=arguments[1],s++);s!==l;){for(e=arguments[s],t=Object.keys(e),r=0;r<t.length;r++)n=e[t[r]],i&&(u(n)||c(n))?(o=a[t[r]],o=a[t[r]]=u(o)||c(o)?o:c(n)?[]:{},d.extend(i,o,n)):a[t[r]]=e[t[r]];s++}return a},isArray:c,show:function(e){var t,n,o,r=document.body;return"none"!==i(e)||(l(e,""),"none"===i(e)&&(t=e.nodeName,n=document.createElement(t),r.appendChild(n),"none"===(o=i(n))&&(o="block"),r.removeChild(n),l(e,o))),e},hide:function(e){return l(e,"none")},toggle:function(e,t){t?this.show(e):this.hide(e)},closest:function(e,t){var n=e&&(e.matches||e.webkitMatchesSelector||e.mozMatchesSelector||e.msMatchesSelector);if(n)for(;e&&e!==document.body;){if(n.bind(e)(t))return e;e=e.parentNode}return!1},offset:function(e){var t,n=0,o=0,r={left:0,top:0};if(null!==e){for(t=e;null!==t;)n+=t.offsetLeft,o+=t.offsetTop,t=t.offsetParent;r.left=n,r.top=o}return r}},d),slider:function(e,n){var t={max:100,min:0,step:5,value:0},T=window.document.body,P=kml.utils.isBrowserSupportTouchEvents(),E=n?Object.keys(n).reduce(function(e,t){return e[t]=n[t],e},t):t,o=(kml.utils.inputTypeSupport("range","a")?function(e){var n=e.appendChild(kml.vanillaSlider.vanilla.create("INPUT",{class:"vanillaSlider",type:"range",max:E.max,min:E.min,step:E.step,value:E.value,"ng-model":"sliderValue"})),t=kml.utils.NOOP;return kml.slider=n,"function"==typeof E.onChange&&(t=E.onChange,n.addEventListener("change",function(e){t.call(this,this.value,e)},!1),n.addEventListener("input",function(e){t.call(this,this.value,e)},!1)),{set:function(e,t){n[e]=t},get:function(e){return n[e]},disable:function(){n.setAttribute("disabled","disabled")},enable:function(){n.removeAttribute("disabled")}}}:function(n){var o,r=kml.utils.NOOP,l=n.appendChild(kml.vanillaSlider.vanilla.create("SPAN",{class:"vanillaSliderElement"})),i=l.offsetWidth/2,a=n.offsetWidth,s=0,c=0,u=E.max,d=E.min,p=E.step,t=u-d,m=t/p,h=a/m,f=function(e){var t=document.createEvent("Event");return t.initEvent(e,!0,!1),t},g=function(e,t){var n=h&&Math.round(Math.abs(e)/h)*p,o="number"==typeof t?t:s;return n&&(c=e<0?Math.max(d,o-n):Math.min(u,o+n),c=Math.round(c/p)*p,y(c),r.call(l,c)),c},y=function(e){l.style.left=(e-d)/t*100+"%"},v={start:P?"touchstart":"mousedown",move:P?"touchmove":"mousemove",end:P?"touchend":"mouseup"},k=0,e=function(e){g(e.pageX-k)},S=function(e){var t;e.target!==l&&(t=this.getBoundingClientRect(),h=t.width/m,s=g(e.pageX-t.left,0))},b=function(e){var t;if("changedTouches"in e){if(1!==e.changedTouches.length)return!0;t=e.changedTouches[0]}else t=e;return o[e.type].call(this,t,e)},w=function(){s=c,l.dispatchEvent(f("blur")),T.removeEventListener(v.move,b,!1),T.removeEventListener(v.end,b,!1)},C=function(e,t){t.preventDefault(),k=e.pageX,a=n.offsetWidth,h=a/m,i=l.offsetWidth/2,l.dispatchEvent(f("focus")),T.addEventListener(v.move,b,!1),T.addEventListener(v.end,b,!1)};return o={mousedown:C,touchstart:C,mousemove:e,touchmove:e,mouseup:w,touchend:w},kml.vanillaSlider.vanilla.addClasses(n,"vanillaSlider"),l.addEventListener(v.start,b,!1),n.addEventListener("click",S,!1),l.style.left=-i+"px","function"==typeof E.onChange&&(r=E.onChange),E.value&&(s=Math.max(Math.min(E.value,u),d),y(s)),{set:function(e,t){s=Math.max(Math.min(t,u),d),y(s),r.call(l,s)},get:function(){return s},disable:function(){l.removeEventListener(v.start,b,!1),n.removeEventListener("click",S,!1),w()},enable:function(){l.addEventListener(v.start,b,!1),n.addEventListener("click",S,!1)}}})(e),r=!1;return{getValue:function(){return o.get("value")},setValue:function(e){return e<E.min&&(e=E.min),e>E.max&&(e=E.max),o.set("value",e),e},disable:function(){r||(o.disable(),r=!0)},enable:function(){r&&(o.enable(),r=!1)}}}}},t=function(){return this||(0,eval)("this")}();"undefined"!=typeof module&&module.exports?module.exports=e:"function"==typeof define&&define.amd?define(function(){return e}):t.VanillaSlider=e}(),function(){var e=function(){var t=kml.args.container.querySelector("#errorMessage");return{inputTypeSupport:function(e,t){var n=document.createElement("input");return n.setAttribute("type",e),n.setAttribute("value",t),n.type===e&&n.value!==t},isBrowserSupportTouchEvents:function(){var t=!0;try{document.createEvent("TouchEvent")}catch(e){t=!1}return t},colorObjToArr:function(e){return Array.isArray(e)?e:[e.r,e.g,e.b,e.a]},rgbToHex:function(e,t,n){return"object"===_typeof(e)?kml.rgbToHex.apply(this,[e.r,e.g,e.b]):"#"+[e,t,n].map(function(e){var t=(e||0).toString(16);return t.length<2?"0"+t:t}).join("")},hexToRGBArray:function(e){var t=this.normalizeHexColor(e),n=function(e){return parseInt(t.slice(e,e+2),16)};return[n(0),n(2),n(4)]},normalizeHexColor:function(e){return e.replace("#","").replace(/^(.)(.)(.)$/,"$1$1$2$2$3$3")},showError:function(e){t.textContent=e,t.style.display=""},hideError:function(){"none"!==t.style.display&&(t.style.display="none")},getSelectValues:function(e){for(var t,n=[],o=e&&e.options,r=0,l=o.length;r<l;r++)(t=o[r]).selected&&n.push({value:t.value});return n},decodeHTMLEntities:function(e){var t=document.createElement("a");return e&&"string"==typeof e&&(e=e.replace(/&amp;nbsp;/g,"")),t.innerHTML=e,t.textContent}}},t=function(){return this||(0,eval)("this")}();"undefined"!=typeof module&&module.exports?module.exports=e:"function"==typeof define&&define.amd?define(function(){return e}):t.Utils=e}(),function(){var t=this,e=function(){var u=null,d=null,p=null,a=[255,69,0,38],m={r:255,g:69,b:0,a:38},r=null,e=function(){var e,t,n,o,r,l,i,a,s,c;u=kml.args.container.querySelector("#colorPicker").querySelectorAll(".quickColorsBox"),p=kml.utils.colorObjToArr(m),e=kml.args.container.querySelector("#colorPicker"),a=e.getElementsByClassName("transparencySlider")[0],s=e.getElementsByClassName("transparencyButtonSet")[0],n=e.getElementsByClassName("transparencySliderValue")[0],o=e.getElementsByClassName("transparencySliderControl")[0],r=kml.vanillaSlider.slider(o,{min:0,max:100,step:5,value:n.textContent=(t=p[3],Math.round(100-100*(t<=1?t:t/255)))}),c={get:function(){return r?Math.round((100-r.getValue())/100*255):0},set:function(e){r.setValue((e.a?e.a:e[3])||0)}},l=a,(i=s).parentNode.removeChild(i),l.style.display="block",d=c};return{getDefaultColor:function(){return a},getDefaultColorHex:function(){return"#FF4500"},getTransparencyControl:function(){return d},getDefaultTransparencyValue:function(){return 85},getPicker:function(){return r},setVariables:e,formColorPicker:function(){e();var n=[],l=function(){return kml.args.container.querySelector("#colorPicker INPUT:not([type='radio'])")},i=function(t){n.forEach(function(e){"change"===e.eventType&&e.callback(t)})};return(r=(kml.utils.inputTypeSupport("color","hello world")?function(){var n=l();return n.type="color",n.addEventListener("change",function(){i(t.value)},!1),{setValue:function(e){var t=kml.utils.rgbToHex.apply(kml,kml.utils.colorObjToArr(e));n.value=t,n.style.opacity=kml.utils.colorObjToArr(e)[3]/255,i(t)},getValue:function(){return kml.utils.hexToRGBArray(n.value)},getHexValue:function(){return n.value}}}:function(){var e=l(),r=new jscolor(e);return r.valueElement.addEventListener("change",function(){i("#"+t.value)},!1),{setValue:function(e){var t=3<e.length?e.slice(0,3):e,n=3<e.length?e.slice(3,4):255*kml.utils.colorObjToArr(a)[3],o=kml.utils.rgbToHex.apply(kml.utils,kml.utils.colorObjToArr(t));r.fromRGB.apply(r,function(e){var t="string"==typeof e?kml.utils.hexToRGBArray(e):e,n=kml.utils.colorObjToArr(t);for(1<Math.max.apply(Math,n)&&(n=n.map(function(e){return void 0===e?1:e/255}));n.length<4;)n.push(0);return n.slice()}(t)),l().style.opacity=n/255,l().style.backgroundColor=o,i(o)},getValue:function(){return(r.rgb||a).map(function(e){return 255*e})},getHexValue:function(){return e.value},originalPicker:r}})()).setValue(p),["#ff4500","#ffa500","#008000","#ffff00","#ADD8E6","#0000ff","#800080"].forEach(function(e){var t=document.createElement("div");t.className="quickColor",t.setAttribute("ng-click","setQuickColor($event)"),t.style.backgroundColor=e,u[0].appendChild(t)}),{value:function(e){var t;return e?(r.setValue(e),d.set(e),e):{r:(t=r.getValue())[0],g:t[1],b:t[2],a:d.get()}},attachEvent:function(e,t){n.push({eventType:e,callback:t})}}},setQuickColor:function(e){if(e.target.style.backgroundColor){var t=e.target.style.backgroundColor,n=t.indexOf("#")<0?/\brgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/g.exec(t).splice(1):kml.utils.hexToRGBArray(t),o=[];o.push(parseInt(n[0],10)),o.push(parseInt(n[1],10)),o.push(parseInt(n[2],10)),o.push(d.get()),r.setValue(o),kml.args.container.querySelector("#colorPickerField").value=r.getHexValue()}},setDefaultColor:function(){r.setValue(a)}}},n=function(){return this||(0,eval)("this")}();"undefined"!=typeof module&&module.exports?module.exports=e:"function"==typeof define&&define.amd?define(function(){return e}):n.ColorPicker=e}(),function(){var e=function(){var n=null,o=null;return{init:function(){n=kml.args.container.getElementsByClassName("dragAndDropUploader")[0],o=n.className;var e=n.getElementsByTagName("input")[0];n.ondragover=function(){return angular.injector(["ng","importKMLZones"]).get("clearService").clear(),n.className=o+" hoverArea",!1},n.ondragleave=function(){return n.className=o,!1},n.ondrop=function(e){e.preventDefault(),n.className=o;var t=e.dataTransfer.files;kml.parseFiles(t)},n.onclick=function(){e.click()}},clear:function(){n.className=o}}},t=function(){return this||(0,eval)("this")}();"undefined"!=typeof module&&module.exports?module.exports=e:"function"==typeof define&&define.amd?define(function(){return e}):t.Uploader=e}(),function(){var e=function(){var e=kml.args.container.querySelector("#waiting"),t=e,n=new Spinner({lines:13,length:24,width:14,radius:42,scale:1,corners:1,color:"#000",opacity:.25,rotate:0,direction:1,speed:1,trail:60,fps:20,zIndex:2e9,className:"spinner",top:"50%",left:"50%",shadow:!1,hwaccel:!1,position:"absolute"}),o=kml.args.container.querySelector("#progressContainer"),r=kml.args.container.querySelector("#importProgress");return{show:function(){e.style.display="",n.spin(t)},hide:function(){e.style.display="none",n.stop()},showProgressBar:function(){o.style.display="",kml.args.container.style.overflow="hidden",kml.args.container.style.height="100%",r.value="0"},hideProgressBar:function(){setTimeout(function(){o&&(o.style.display="none",kml.args.container.style.overflow="",kml.args.container.style.height="auto")},400)},updateProgressBar:function(e){r&&(r.value+=e)}}},t=function(){return this||(0,eval)("this")}();"undefined"!=typeof module&&module.exports?module.exports=e:"function"==typeof define&&define.amd?define(function(){return e}):t.Waiting=e}();